<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Aurora Tech ¬∑ Gest√£o de Escolinhas{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
<div class="app-shell">
    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div>
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">AT</div>
                <div class="sidebar-logo-text">
                    <span class="sidebar-logo-title">
                        {% if current_user.is_authenticated and current_user.escolinha_nome %}
                            {{ current_user.escolinha_nome }}
                        {% else %}
                            Aurora Tech ¬∑ Escolinhas
                        {% endif %}
                    </span>
                    <span class="sidebar-logo-subtitle">Portal de Gest√£o Esportiva</span>
                </div>
            </div>

            {% if current_user.is_authenticated %}
            {% set ep = request.endpoint or '' %}
            {% set role = current_user.role or '' %}

            <ul class="sidebar-nav">
                <!-- Dashboard -->
                <li>
                    <a href="{{ url_for('dashboard.index') }}"
                       class="{% if ep.startswith('dashboard') %}active{% endif %}">
                        <span class="icon">üè†</span> Vis√£o Geral
                    </a>
                </li>

                <!-- Alunos & Respons√°veis -->
                {% if role in ['ADMIN', 'COACH', 'SUPER_ADMIN', 'PARENT'] %}
                <li>
                    <a href="{{ url_for('atletas.listar') }}"
                       class="{% if ep.startswith('atletas') %}active{% endif %}">
                        <span class="icon">üë®‚Äçüë©‚Äçüë¶</span> Alunos & Respons√°veis
                    </a>
                </li>
                {% endif %}

                <!-- Grupos -->
                {% if role in ['ADMIN', 'COACH', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('grupos.listar') }}"
                       class="{% if ep.startswith('grupos') %}active{% endif %}">
                        <span class="icon">üë•</span> Grupos
                    </a>
                </li>
                {% endif %}

                <!-- Planos -->
                {% if role in ['ADMIN', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('planos.listar') }}"
                       class="{% if ep.startswith('planos') %}active{% endif %}">
                        <span class="icon">üé´</span> Planos
                    </a>
                </li>
                {% endif %}

                <!-- Agenda (atividades) -->
                {% if role in ['ADMIN', 'COACH', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('atividades.listar') }}"
                       class="{% if ep.startswith('atividades') %}active{% endif %}">
                        <span class="icon">üìÖ</span> Agenda
                    </a>
                </li>
                {% endif %}

                <!-- Financeiro -->
                {% if role in ['ADMIN', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('financeiro.resumo') }}"
                       class="{% if ep.startswith('financeiro') %}active{% endif %}">
                        <span class="icon">üí∞</span> Financeiro
                    </a>
                </li>
                {% elif role == 'PARENT' %}
                <li>
                    <a href="{{ url_for('financeiro.resumo_responsavel') }}"
                       class="{% if ep == 'financeiro.resumo_responsavel' %}active{% endif %}">
                        <span class="icon">üí∞</span> Minhas mensalidades
                    </a>
                </li>
                {% endif %}

                <!-- Usu√°rios do Sistema -->
                {% if role in ['ADMIN', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('usuarios_sistema.listar') }}"
                       class="{% if ep.startswith('usuarios_sistema') %}active{% endif %}">
                        <span class="icon">üßë‚Äçüíª</span> Usu√°rios do Sistema
                    </a>
                </li>
                {% endif %}

                <!-- IA Coach -->
                {% if role in ['ADMIN', 'COACH', 'SUPER_ADMIN'] %}
                <li>
                    <a href="{{ url_for('ia.index') }}"
                       class="{% if ep.startswith('ia') %}active{% endif %}">
                        <span class="icon">ü§ñ</span> IA Coach
                    </a>
                </li>
                {% endif %}
            </ul>
            {% endif %}
        </div>

        {% if current_user.is_authenticated %}
        <div class="sidebar-user">
            <div class="sidebar-user-info">
                <span class="sidebar-user-name">{{ current_user.nome }}</span>
                <span class="sidebar-user-role">{{ current_user.role }}</span>
            </div>
            <div>
                <div class="sidebar-user-status-pill">
                    ‚óè Online
                </div>
                <form method="post" action="{{ url_for('auth.logout') }}" style="margin-top:0.35rem;">
                    <button type="submit" class="btn btn-sm btn-outline">Sair</button>
                </form>
            </div>
        </div>
        {% endif %}
    </aside>

    <!-- MAIN -->
    <main class="main">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div style="margin-bottom:0.75rem;">
              {% for category, message in messages %}
                <div class="badge badge-{{ 'danger' if category == 'error' else 'neutral' }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        {% block content %}{% endblock %}
    </main>
</div>

<!-- Se voc√™ tiver scripts globais, coloque aqui -->
<script src="{{ url_for('static', filename='js/camera.js') }}"></script>
</body>
</html>
