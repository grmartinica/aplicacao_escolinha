{% extends "base.html" %}
{% block title %}Agenda{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Agenda</h1>
        <p class="page-subtitle">Visualize os treinos e atividades no calendário mensal.</p>
    </div>
    <a href="{{ url_for('atividades.nova') }}" class="btn btn-primary">+ Nova atividade</a>
</div>

<div class="card">
    <div class="card-body">
        <div class="calendar-nav">
            <a class="btn btn-outline"
               href="{{ url_for('atividades.listar', ano=ano if mes > 1 else ano-1, mes=mes-1 if mes > 1 else 12) }}">
                « Mês anterior
            </a>
            <div class="calendar-title">
                {{ "%02d"|format(mes) }}/{{ ano }}
            </div>
            <a class="btn btn-outline"
               href="{{ url_for('atividades.listar', ano=ano if mes < 12 else ano+1, mes=mes+1 if mes < 12 else 1) }}">
                Próximo mês »
            </a>
        </div>

        <div class="calendar">
            <div class="calendar-head">Seg</div>
            <div class="calendar-head">Ter</div>
            <div class="calendar-head">Qua</div>
            <div class="calendar-head">Qui</div>
            <div class="calendar-head">Sex</div>
            <div class="calendar-head">Sáb</div>
            <div class="calendar-head">Dom</div>

            {% for semana in semanas %}
                {% for dia in semana %}
                    <div class="calendar-cell {% if dia == 0 %}calendar-empty{% endif %}">
                        {% if dia != 0 %}
                            <div class="calendar-day-number">{{ dia }}</div>
                            {% set eventos = eventos_por_dia.get(dia, []) %}
                            {% for ev in eventos %}
                                <div class="calendar-event">
                                    <div class="calendar-event-time">
                                        {{ ev.hora_inicio.strftime('%H:%M') if ev.hora_inicio else '' }}
                                    </div>
                                    <div class="calendar-event-title">
                                        {{ ev.titulo }}
                                    </div>
                                    <div class="calendar-event-group">
                                        {{ ev.grupo.nome if ev.grupo else '-' }}
                                    </div>
                                    <a href="{{ url_for('atividades.presencas', atividade_id=ev.id) }}"
                                       class="calendar-event-link">Presenças</a>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                {% endfor %}
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
