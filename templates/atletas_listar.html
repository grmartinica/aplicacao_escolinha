{% extends "base.html" %}
{% block title %}Alunos & Responsáveis · Aurora Tech{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Alunos & Responsáveis</h1>
        <p class="page-subtitle">
            Cadastre e gerencie os atletas, responsáveis, documentos e vínculos com grupos.
        </p>
    </div>
    <div class="page-header-actions">
        <a href="{{ url_for('atletas.importar') }}" class="btn btn-secondary">
            Importar
        </a>

        <div class="btn-group">
            <a href="{{ url_for('atletas.exportar', formato='excel') }}" class="btn btn-secondary">
                Excel
            </a>
            <a href="{{ url_for('atletas.exportar', formato='csv') }}" class="btn btn-secondary">
                CSV
            </a>
            <a href="{{ url_for('atletas.exportar', formato='pdf') }}" class="btn btn-secondary">
                PDF
            </a>
            <a href="{{ url_for('atletas.exportar', formato='word') }}" class="btn btn-secondary">
                Word
            </a>
        </div>

        <a href="{{ url_for('atletas.novo') }}" class="btn btn-primary">
            + Novo aluno
        </a>
    </div>
</div>

<div class="card">
    <div class="card-body">

        <div class="filters mb-3">
            <form method="get" class="row g-2 align-items-end">
                <div class="col-md-4">
                    <label class="form-label">Nome</label>
                    <input type="text"
                           name="nome"
                           class="form-control"
                           placeholder="Buscar por nome"
                           value="{{ filtros.nome or '' }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Grupo</label>
                    <select name="grupo_id" class="form-select">
                        <option value="">Todos</option>
                        {% for g in grupos %}
                            <option value="{{ g.id }}"
                                    {% if filtros.grupo_id and filtros.grupo_id|int == g.id %}selected{% endif %}>
                                {{ g.nome }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-2">
                    <label class="form-label">Idade</label>
                    <input type="number"
                           name="idade"
                           class="form-control"
                           min="1"
                           value="{{ filtros.idade or '' }}">
                </div>
                <div class="col-md-3 d-flex gap-2">
                    <button type="submit" class="btn btn-primary flex-grow-1 mt-4">
                        Filtrar
                    </button>
                    <a href="{{ url_for('atletas.listar') }}" class="btn btn-outline-secondary mt-4">
                        Limpar
                    </a>
                </div>
            </form>
        </div>

        {% if atletas %}
        <table class="table table-striped">
            <thead>
            <tr>
                <th>Nome</th>
                <th>Idade</th>
                <th>Posição</th>
                <th>Responsável</th>
                <th>Telefone</th>
                <th>Financeiro</th>
                <th>Documentos</th>
                <th>Ações</th>
            </tr>
            </thead>
            <tbody>
            {% for a in atletas %}
            <tr>
                <td>{{ a.nome }}</td>
                <td>
                    {% if a.idade_anos %}
                        {{ a.idade_anos }} anos
                    {% else %}
                        —
                    {% endif %}
                </td>
                <td>{{ a.posicao or '—' }}</td>
                <td>{{ a.responsavel_nome or '—' }}</td>
                <td>{{ a.responsavel_telefone or a.telefone or '—' }}</td>
                <td>
                    {% if a.tem_pend_financeira %}
                        <span class="badge badge-danger">Pendências</span>
                    {% else %}
                        <span class="badge badge-success">Em dia</span>
                    {% endif %}
                </td>
                <td>
                    {% if a.docs_pendentes %}
                        <span class="badge badge-danger">Pendentes</span>
                    {% else %}
                        <span class="badge badge-success">OK</span>
                    {% endif %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm" role="group">
                        <a href="{{ url_for('atletas.editar', atleta_id=a.id) }}" class="btn btn-outline-primary">
                            Ver / Editar
                        </a>

                        <a href="{{ url_for('atletas.cobrar_documentos', atleta_id=a.id) }}"
                            class="btn btn-outline-secondary" target="_blank">
                            Cobrar docs
                        </a>

                        {% if a.tem_pend_financeira %}
                        <a href="{{ url_for('financeiro.cobrar_whatsapp', atleta_id=a.id) }}"
                            class="btn btn-outline-danger" target="_blank">
                            Cobrança financeira
                        </a>
                        {% endif %}
                    </div>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
            <p class="empty-state">
                Nenhum aluno cadastrado ainda. Clique em <strong>“Novo aluno”</strong> para começar.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}
